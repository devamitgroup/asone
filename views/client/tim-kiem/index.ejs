<!DOCTYPE html>
<html lang="vi">
<%- include('../partials/head', { title: title }) %>
<body>
    <%- include('../partials/header') %>

    <div class="navi">
        <div class="w-ct padding15">
            <a href="/">Trang chủ</a><span>/</span>
            <span>Kết quả tìm kiếm</span>
        </div>
    </div>

    <div class="w-ct clearfix lstproduct padding15">
        <h1 class="htitle1"><span>Kết quả tìm kiếm</span></h1>
        <div id="listproduct" class="row">
            <div class="col-xs-12 text-center" id="search-status">Đang tìm kiếm...</div>
        </div>
    </div>

    <%- include('../partials/footer') %>
    <%- include('../partials/social_ring') %>
    <%- include('../partials/scripts') %>

    <script>
        (async () => {
            const param = new URLSearchParams(window.location.search);
            const keyword = param.get('keyword');
            const listproduct = document.getElementById('listproduct');
            const status = document.getElementById('search-status');

            if (!keyword) {
                status.innerText = 'Vui lòng nhập từ khóa tìm kiếm.';
                return;
            }

            try {
                const response = await fetch('/san-pham/tim-kiem?keyword=' + encodeURIComponent(keyword));
                const data = await response.json();
                
                if (data && data.length > 0) {
                    listproduct.innerHTML = '';
                    data.forEach(value => {
                        listproduct.innerHTML += `
                            <div class="col-md-3 col-sm-4 col-xs-6">
                                <div class="p-i">
                                    <a class="p-img" href="/san-pham/${value.slug}" title="${value.name}">
                                        <img src="/${value.images[0]}" alt="${value.name}">
                                    </a>
                                    <h3><a href="/san-pham/${value.slug}">${value.name}</a></h3>
                                    <p class="price-box"><span class="price-news">Giá: Liên hệ</span></p>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    status.innerText = 'Không tìm thấy sản phẩm nào matching với "' + keyword + '".';
                }
            } catch (e) {
                console.error('Search error:', e);
                status.innerText = 'Lỗi khi thực hiện tìm kiếm.';
            }
        })();
    </script>
</body>
</html>
